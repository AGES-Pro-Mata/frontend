services:
  # Development Frontend - Updated for React 19
  frontend:
    build:
      context: .
      dockerfile: Dockerfile.dev
    container_name: promata-frontend
    environment:
      - NODE_ENV=development
      - VITE_API_URL=${VITE_API_URL:-http://localhost:8080/api}
      - VITE_APP_ENV=${VITE_APP_ENV:-development}
      - VITE_APP_VERSION=${VITE_APP_VERSION:-local}
      - CHOKIDAR_USEPOLLING=true
    ports:
      - "${FRONTEND_DEV_PORT_MAPPING:-3000:3000}"
    volumes:
      - .:/app
      - frontend_node_modules:/app/node_modules
      - frontend_vite_cache:/app/.vite
      - frontend_cache:/app/.cache
    networks:
      - promata_dev
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

  # Production Frontend - Updated for React 19 + Vite 6
  frontend-prod:
    build:
      context: .
      dockerfile: Dockerfile.prod
      args:
        BUILD_DATE: ${BUILD_DATE:-$(date -u +'%Y-%m-%dT%H:%M:%SZ')}
        VCS_REF: ${VCS_REF:-local}
        VERSION: ${VERSION:-local}
        VITE_API_URL: ${VITE_API_URL:-http://localhost:8080/api}
        VITE_APP_ENV: ${VITE_APP_ENV:-production}
        VITE_APP_VERSION: ${VITE_APP_VERSION:-local}
    container_name: promata-frontend-prod
    environment:
      - NODE_ENV=production
    ports:
      - "${FRONTEND_PROD_PORT_MAPPING:-8080:8080}"
    networks:
      - promata_prod
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    profiles: ["prod-test"]

volumes:
  frontend_node_modules:
  frontend_vite_cache:
  frontend_cache:

networks:
  promata_dev:
    driver: bridge
  promata_prod:
    driver: bridge